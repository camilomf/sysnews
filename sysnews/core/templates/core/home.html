{% extends 'core/base.html' %}
{% load user_tags %}
{% block title %}
Home
{% endblock title %}

{% block content %}
{% include 'news/includes/news_menu.html' %}
<div class="row">

  <!-- Blog Entries Column -->  
  <div class="col-md-8">

    <!-- <h1 class="my-4">Page Heading
      <small>Secondary Text</small>
    </h1> -->

    <!-- Blog Post -->
    
    {% if not news_list %}
    <br>
      <h3>No hay Resultados :(</h3>
    {% else %}
    {% for news in news_list %}
    <div class="card mb-4 mt-3">
      <img class="card-img-top" src="{{ news.image.url }}" alt="Card image cap">
      <div class="card-body">
        <h2 class="card-title">{{ news.title }}</h2>
        <p class="card-text">{{ news.headline }}</p>
        <a href="{% url 'news:detail' news.id news.title|slugify %}" class="btn btn-primary">Read More &rarr;</a>
      </div>
      <div class="card-footer text-muted d-flex justify-content-between align-items-center">
        <div>
          Publicado el {{ news.publication_date }} por 
          <a style="color: #009ee8;";>{{ news.editor.first_name }}</a> 
        </div>
        <div>
          {% if request.user|has_group:'Editor' or request.user|has_group:'Admin' %}
          {% if request.user == news.editor %}
          <a href="{% url 'news:update' news.id %}"><button class="btn btn-warning">Editar</button></a>
          <button type="button" class="btn btn-danger" data-toggle="modal" data-target="#eliminar">Eliminar</button>
          {% endif %}  
          {% endif %}  
        </div>
      </div>
    </div>

      <!-- Eliminar -->
      {% if request.user|has_group:'Editor' or request.user|has_group:'Admin' %}
      <div id="eliminar" class="modal fade" role="dialog">
      <div class="modal-dialog modal-dialog-centered modal-sm" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h4 class="modal-title">Noticia (delete)</h4>
            <button class="close" type="button" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <form role="form" method="post" action="{% url 'news:delete' news.id %}">{% csrf_token %}
            <div class="modal-body">
              <p>¿Estás seguro de que quieres borrar noticia {{ news.title }}?</p>
            </div>
            <div class="modal-footer">
              <button type="submit" class="btn btn-danger"><span class="fa fa-save"></span> Sí</button>
              <button type="button" class="btn btn-secondary" data-dismiss="modal">No</button>
            </div>
          </form>
        </div>
      </div>
      </div>
      {% endif %}

    {% endfor %}
    {% endif %}
      


    <!-- Pagination -->
    <!-- <ul class="pagination justify-content-center mb-4">
      <li class="page-item">
        <a class="page-link" href="#">&larr; Older</a>
      </li>
      <li class="page-item disabled">
        <a class="page-link" href="#">Newer &rarr;</a>
      </li>
    </ul>
-->
    {% if is_paginated %}
    <ul class="pagination">
      {% if page_obj.has_previous %}
      <li>
          <span><a href="?page={{ page_obj.previous_page_number }}">&larr; </a>&nbsp;</span>
      </li>
      {% endif %}
      <li class="">
          <span> Pág {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}. </span>
      </li>
      {% if page_obj.has_next %}
      <li>
          <span>&nbsp; <a href="?page={{ page_obj.next_page_number }}">&rarr;</a></span>
      </li>
      {% endif %}
    </ul>
    {% endif %}

  </div> 

  <!-- Sidebar Widgets Column -->
  <div class="col-md-4">

    <!-- Search Widget -->
    <div class="card my-4">
      <h5 class="card-header">Busqueda por título</h5>
      <div class="card-body">
        <form method="POST" action="{% url 'search_by_title' %}">{% csrf_token %}         
          <div class="input-group">
            <input type="text" required name="search_by_title" id="buscador" class="form-control" placeholder="Buscar ..." value="{{ request.GET.search_by_title }}">
            <button type="submit" class="btn btn-info">
              <span class="glyphicon glyphicon-search"></span> Buscar
            </button>
          </div>
          </form>
      </div>
    </div>

    <div class="card my-4">
      <h5 class="card-header">Búsqueda por fecha</h5>
      <div class="card-body">
        <form method="POST" action="{% url 'search_by_date' %}">{% csrf_token %}         
          <div class="input-group">
            <input type="date" required name="search_by_date" id="buscador" class="form-control" placeholder="" value="{{ request.GET.search_by_date }}">
            <button type="submit" class="btn btn-info">
              <span class="glyphicon glyphicon-search"></span> Buscar
            </button>
          </div>
          </form>
      </div>
    </div>

    <!-- Categories Widget -->
    <div class="card my-4">
      <h5 class="card-header">Paises</h5>
      <div class="card-body">
        <div class="row">
          <div class="col-lg-6">
            <ul class="list-unstyled mb-0">
              {% for country in countries %}
              <li>
                <a href="{% url 'search_by_country' id=country.id %}">{{ country.name }}</a>
              </li>  
              {% endfor %}
            </ul>
          </div>
        </div>
      </div>
    </div>

    <!-- Side Widget -->
    <div class="card my-4">
      <h5 class="card-header">Side Widget</h5>
      <div class="card-body">
        You can put anything you want inside of these side widgets. They are easy to use, and feature the new Bootstrap 4 card containers!
      </div>
    </div>

  </div>
  


</div>
<!-- /.row -->
{% endblock content %}

{% block script %}
<script>
  function setInputDate(_id){
    var _dat = document.querySelector(_id);
    var hoy = new Date(),
        d = hoy.getDate(),
        m = hoy.getMonth()+1, 
        y = hoy.getFullYear(),
        data;

    if(d < 10){
        d = "0"+d;
    };
    if(m < 10){
        m = "0"+m;
    };

    data = y+"-"+m+"-"+d;
    console.log(data);
    _dat.value = data;
  };
  // setInputDate("#calendar");
  setInputDate("#publication_date");
  </script>

{% endblock script %}
